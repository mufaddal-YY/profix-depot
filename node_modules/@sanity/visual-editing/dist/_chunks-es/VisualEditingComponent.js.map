{"version":3,"file":"VisualEditingComponent.js","sources":["../../src/next-pages-router/VisualEditingComponent.tsx"],"sourcesContent":["import {useRouter} from 'next/router.js'\nimport {useEffect, useRef, useState} from 'react'\nimport type {HistoryAdapterNavigate, VisualEditingOptions} from '../types'\nimport {enableVisualEditing} from '../ui/enableVisualEditing'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history'> {\n  /**\n   * @deprecated The history adapter is already implemented\n   */\n  history?: never\n}\n\nexport default function VisualEditingComponent(props: VisualEditingProps): null {\n  const {components, refresh, zIndex} = props\n\n  const router = useRouter()\n  const routerRef = useRef(router)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n\n  useEffect(() => {\n    routerRef.current = router\n  }, [router])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      components,\n      zIndex,\n      refresh,\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          switch (update.type) {\n            case 'push':\n              return routerRef.current.push(update.url)\n            case 'pop':\n              return routerRef.current.back()\n            case 'replace':\n              return routerRef.current.replace(update.url)\n            default:\n              throw new Error(`Unknown update type: ${update.type}`)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [components, refresh, zIndex])\n\n  const {asPath, basePath, locale, isReady} = useRouter()\n  useEffect(() => {\n    if (navigate && isReady) {\n      const url =\n        basePath || locale\n          ? `${basePath}${locale ? `/${locale}` : ''}${asPath === '/' ? '' : asPath}`\n          : asPath\n      navigate({type: 'push', url})\n    }\n  }, [asPath, basePath, isReady, locale, navigate])\n\n  return null\n}\n"],"names":["VisualEditingComponent","props","$","_c","components","refresh","zIndex","router","useRouter","routerRef","useRef","navigate","setNavigate","useState","t0","t1","current","useEffect","t2","t3","disable","enableVisualEditing","history","subscribe","_navigate","undefined","update","type","push","url","back","replace","Error","asPath","basePath","locale","isReady","t4","t5"],"mappings":";;;;AAeA,SAAeA,uBAAAC,OAAA;AAAAC,QAAAA,IAAAC,EAAA,EAAA,GACb;AAAA,IAAAC;AAAAA,IAAAC;AAAAA,IAAAC;AAAAA,EAAsCL,IAAAA,OAEtCM,SAAeC,UAAAA,GACfC,YAAkBC,OAAOH,MAAM,GAC/B,CAAAI,UAAAC,WAAA,IAAgCC,SAA6C;AAAC,MAAAC,IAAAC;AAAAb,WAAAK,UAEpEO,KAAAA,MAAA;AACRL,cAASO,UAAWT;AAAAA,EAAM,GACzBQ,MAACR,MAAM,GAACL,OAAAK,QAAAL,OAAAY,IAAAZ,OAAAa,OAAAD,KAAAZ,EAAA,CAAA,GAAAa,KAAAb,EAAA,CAAA,IAFXe,UAAUH,IAEPC,EAAQ;AAAC,MAAAG,IAAAC;AAAAjB,IAAAE,CAAAA,MAAAA,cAAAF,SAAAG,WAAAH,EAAA,CAAA,MAAAI,UACFY,KAAAA,MAAA;AACR,UAAAE,UAAgBC,oBAAA;AAAA,MAAAjB;AAAAA,MAAAE;AAAAA,MAAAD;AAAAA,MAAAiB,SAAA;AAAA,QAAAC,WAAAC,gBAMVZ,YAAW,MAAOY,SAAS,GACdZ,MAAAA,YAAWa,MAAU;AAAA,QAACC,QAAAA,CAAA,WAAA;AAAA,kBAG3BA,OAAMC,MAAA;AAAA,YAAA,KACP;AAAM,qBACFlB,UAASO,QAAAY,KAAcF,OAAMG,GAAI;AAAA,YAAC,KACtC;AACIpB,qBAAAA,UAASO,QAAAc,KAAc;AAAA,YAAC,KAC5B;AAAS,qBACLrB,UAASO,QAAAe,QAAiBL,OAAMG,GAAI;AAAA,YAAC;AAAA,oBAAA,IAAAG,MAE5B,wBAAwBN,OAAMC,IAAA,EAAO;AAAA,UAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAAA,CAI9D;AAAC,WACWP,MAAAA,QAAQ;AAAA,EAAA,GACpBD,KAACf,CAAAA,YAAYC,SAASC,MAAM,GAACJ,OAAAE,YAAAF,OAAAG,SAAAH,OAAAI,QAAAJ,OAAAgB,IAAAhB,OAAAiB,OAAAD,KAAAhB,EAAA,CAAA,GAAAiB,KAAAjB,EAAA,CAAA,IAzBhCe,UAAUC,IAyBPC,EAA6B;AAEhC,QAAA;AAAA,IAAAc;AAAAA,IAAAC;AAAAA,IAAAC;AAAAA,IAAAC;AAAAA,MAA4C5B,UAAU;AAAC,MAAA6B,IAAAC;AAAApC,SAAAA,EAAA+B,CAAAA,MAAAA,UAAA/B,EAAA,CAAA,MAAAgC,YAAAhC,EAAAkC,EAAAA,MAAAA,WAAAlC,EAAA,EAAA,MAAAiC,UAAAjC,UAAAS,YAC7C0B,KAAAA,MAAA;AAAA,QACJ1B,YAAYyB,SAAO;AACrB,YAAAP,MACEK,YAAYC,SACR,GAAGD,QAAQ,GAAGC,SAAS,IAAIA,MAAM,KAAK,EAAE,GAAGF,WAAW,MAAM,KAAKA,MAAM,KACvEA;AACE,eAAA;AAAA,QAAAN,MAAQ;AAAA,QAAME;AAAAA,MAAAA,CAAM;AAAA,IAAA;AAAA,EAAC,GAE9BS,KAAA,CAACL,QAAQC,UAAUE,SAASD,QAAQxB,QAAQ,GAACT,OAAA+B,QAAA/B,OAAAgC,UAAAhC,QAAAkC,SAAAlC,QAAAiC,QAAAjC,QAAAS,UAAAT,QAAAmC,IAAAnC,QAAAoC,OAAAD,KAAAnC,EAAA,EAAA,GAAAoC,KAAApC,EAAA,EAAA,IARhDe,UAAUoB,IAQPC,EAA6C,GAAC;AAAA;"}